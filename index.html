<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Learn to Code â€“ Start</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/mode/javascript/javascript.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #editor { height: 200px; }
    #output { background: #f0f0f0; padding: 10px; margin-top: 10px; white-space: pre-wrap; }
    #startScreen, #lessonSection { display: none; }
  </style>
  <script>
    let editor;

    async function validateLicenseKey() {
      if (true) {
        localStorage.setItem("validLicense", "true");
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("startScreen").style.display = "block";
      } else {
        alert("Invalid license key. Please check your Gumroad purchase.");
      }
    }

    function showLesson() {
      document.getElementById("startScreen").style.display = "none";
      document.getElementById("lessonSection").style.display = "block";
      loadLesson();
    }

    function loadLesson() {
      document.getElementById("lessonTitle").innerText = "Lesson 1: Print a message";
      document.getElementById("lessonText").innerText =
        "Welcome to your first programming lesson!\n\n" +
        "ðŸ§  In programming, we can send a message to the screen using a special command called console.log.\n\n" +
        "âœï¸ Example:\n" +
        'console.log("Hello, World!");\n\n' +
        "This line prints the message Hello, World!\n\n" +
        "ðŸ§ª Now you try: type exactly that line and click 'Run Code'.";

      editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
        lineNumbers: true,
        mode: "javascript",
        theme: "default"
      });

      editor.setValue("// Type your code here...");
    }

    function runCode() {
      const code = editor.getValue();
      let userOutput = "";
      const log = console.log;
      console.log = (...args) => userOutput += args.join(" ") + "\n";

      try {
        eval(code);
        console.log = log;

        if (!code.includes("console.log")) {
          document.getElementById("output").textContent =
            "âŒ You need to use the command console.log(...) to print something.
" +
            "ðŸ’¡ Tip: Try this: console.log("Hello, World!");";
          return;
        }
        if (!code.includes('"') && !code.includes("'")) {
          document.getElementById("output").textContent =
            "âŒ Your message must be inside quotation marks.
" +
            "ðŸ’¡ Tip: Use double quotes like this: console.log("Hello, World!");";
          return;
        }

        const trimmedOutput = userOutput.trim();
        if (trimmedOutput === "Hello, World!") {
          document.getElementById("output").textContent = "âœ… Correct! You've completed Lesson 1.";
        } else {
          document.getElementById("output").textContent =
            `âš ï¸ Your output was: "${trimmedOutput}"
` +
            "ðŸ’¡ It should be exactly: Hello, World!";
        }
      } catch (e) {
        console.log = log;
        document.getElementById("output").textContent =
          "âŒ Error in your code: " + e.message + "\n" +
          "ðŸ’¡ Make sure you type: console.log("Hello, World!");";
      }
    }

    window.onload = () => {
      if (localStorage.getItem("validLicense") === "true") {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("startScreen").style.display = "block";
      }
    };
  </script>
</head>
<body>
  <div id="loginSection">
    <h2>Enter your Gumroad License Key</h2>
    <input type="text" id="licenseKey" placeholder="Your license key">
    <button onclick="validateLicenseKey()">Access Course</button>
  </div>

  <div id="startScreen">
    <h1>Welcome to Learn to Code</h1>
    <p>This course is for absolute beginners.</p>
    <p>We'll start with the basics and move step by step.</p>
    <button onclick="showLesson()">Start Lesson 1</button>
  </div>

  <div id="lessonSection">
    <h1 id="lessonTitle"></h1>
    <pre id="lessonText"></pre>
    <textarea id="editor"></textarea><br>
    <button onclick="runCode()">Run Code</button>
    <pre id="output"></pre>
  </div>
</body>
</html>
