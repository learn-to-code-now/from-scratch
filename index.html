<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Learn to Code – Login</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/mode/javascript/javascript.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #editor { height: 200px; }
    #output { background: #f0f0f0; padding: 10px; margin-top: 10px; white-space: pre-wrap; }
  </style>
  <script>
    let editor;

    async function validateLicenseKey() {
      // Test-Modus: Lizenzprüfung überspringen
      if (true) {
        localStorage.setItem("validLicense", "true");
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("lessonSection").style.display = "block";
        loadLesson();
      } else {
        alert("Invalid license key. Please check your Gumroad purchase.");
      }
    }

    function loadLesson() {
      document.getElementById("lessonTitle").innerText = "Lesson 1: Hello World";
      document.getElementById("lessonText").innerText = "Write a line of JavaScript that prints 'Hello, World!' to the console.";

      editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
        lineNumbers: true,
        mode: "javascript",
        theme: "default"
      });

      editor.setValue("// Your code here");
    }

    function runCode() {
      const code = editor.getValue();
      try {
        const output = [];
        const originalLog = console.log;
        console.log = (...args) => output.push(args.join(" "));
        eval(code);
        console.log = originalLog;
        const result = output.join("\n");

        if (result.trim() === "Hello, World!") {
          document.getElementById("output").textContent = "✅ Correct! Well done.";
        } else {
          document.getElementById("output").textContent = `⚠️ Output: ${result}`;
        }
      } catch (e) {
        document.getElementById("output").textContent = `❌ Error: ${e.message}`;
      }
    }

    window.onload = () => {
      if (localStorage.getItem("validLicense") === "true") {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("lessonSection").style.display = "block";
        loadLesson();
      }
    };
  </script>
</head>
<body>
  <div id="loginSection">
    <h2>Enter your Gumroad License Key</h2>
    <input type="text" id="licenseKey" placeholder="Your license key">
    <button onclick="validateLicenseKey()">Access Course</button>
  </div>

  <div id="lessonSection" style="display:none;">
    <h1 id="lessonTitle"></h1>
    <p id="lessonText"></p>
    <textarea id="editor"></textarea><br>
    <button onclick="runCode()">Run Code</button>
    <pre id="output"></pre>
  </div>
</body>
</html>
